



BROKER SCHEMA org.krakends.middleware.connectors


CREATE COMPUTE MODULE CICSConnector_MakeMsg2CICS
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
		DECLARE MsgIn CHARACTER;
		DECLARE CICSReqMsg BLOB;
		--SETEAMOS NOMBRE DE PROGRAMA A SER INVOCADO, VALIDANDO QUE EXISTA EL NOMBRE DEL PROGRAMA

		SET OutputLocalEnvironment.Destination.CICS.CICSProgramName = InputLocalEnvironment.REST.Input.Parameters.programid;
		--RESCATAMS LA DATA PARA INVICAR AL CICS
		SET MsgIn = InputLocalEnvironment.REST.Input.Parameters.commarea;
		--EXTRAEMOS LA TRX A SER EJECUTADA
		SET OutputLocalEnvironment.Destination.CICS.mirrorTran =
		SUBSTRING(MsgIn FROM 1 FOR 4);
		--SUBSTRING(InputRoot.JSON.Data.CICSConnectorRequest.CommArea FROM 1 FOR 4); Fix en variable commarea para mirrortran
		--SETEAMOS LA DATA DE ASCCI A EBCDIC PARA MENSAJE DE REQUEST AL NODO CICSREQUEST
		SET CICSReqMsg = CAST (MsgIn as BLOB CCSID 037);
		SET OutputRoot.BLOB.BLOB = CICSReqMsg;
		RETURN TRUE;
	END;
END MODULE;
